<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="yanm1ng&#39;s blog">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      Calcite简介 | LoopJump&#39;s Blog
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  
<link rel="stylesheet" href="/css/style.css">

  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    
<script src="/js/qrious.js"></script>

  
  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


  
  
    
<script src="/js/local-search.js"></script>


<meta name="generator" content="Hexo 7.3.0"></head>
<div class="wechat-share">
  <img src="/css/images/logo.png" />
</div>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>LoopJump's Blog</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/series/" class="item-link">Series</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
      
        <li class="menu-item menu-item-search right-list">
    <a role="button" class="popup-trigger">
        <i class="fa fa-search fa-fw"></i>
    </a>
</li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/series/" class="menu-link">Series</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
    
      <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
            <span class="search-icon">
                <i class="fa fa-search"></i>
            </span>
            <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off"
                    placeholder="Please enter your keyword(s) to search." spellcheck="false"
                    type="search" class="search-input">
            </div>
            <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>
    
  </div>
</header>

    <div id="article-banner">
  <h2>Calcite简介</h2>
  <p class="post-date">2019-11-01</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><p>Calcite是Apache旗下开源的、支持多种数据源、提供查询处理&#x2F;查询优化&#x2F;查询语言的基础软件框架。</p>
<p>Calcite的三个特点：</p>
<ul>
<li>标准SQL: 工业级的SQL parser, validator, JDBC Driver</li>
<li>查询优化器：将查询表达为关系代数，计划生成，基于代价的优化</li>
<li>数据源适配：融合第三方数据源</li>
</ul>
<p>SIGMOD18上的Calcite总结论文《Apache Calcite: A Foundational Framework for Optimized Query Processing Over Heterogeneous Data Sources》。</p>
<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><h3 id="Calcite框架组成"><a href="#Calcite框架组成" class="headerlink" title="Calcite框架组成"></a>Calcite框架组成</h3><ul>
<li>模块化可扩展的查询优化器，内置几百种优化规则</li>
<li>强大的查询处理器，可以处理多种查询语言</li>
<li>可扩展的适配器架构，可以支持多种异构数据源，甚至可以跨源做计划优化</li>
</ul>
<h3 id="Calcite与数据引擎的功能边界划分"><a href="#Calcite与数据引擎的功能边界划分" class="headerlink" title="Calcite与数据引擎的功能边界划分"></a>Calcite与数据引擎的功能边界划分</h3><p><a target="_blank" rel="noopener" href="http://loopjump.com/wp-content/uploads/2019/11/image-20191029155418474.png">http://loopjump.com/wp-content/uploads/2019/11/image-20191029155418474.png</a></p>
<p>!<a target="_blank" rel="noopener" href="http://loopjump.com/wp-content/uploads/2019/11/image-20191029155418474.png">http://loopjump.com/wp-content/uploads/2019/11/image-20191029155418474.png</a></p>
<p><img src="https://prod-files-secure.s3.us-west-2.amazonaws.com/4c61fdf7-a36e-430e-bcfa-8388fe1d6ec9/c08cfc02-24b3-4c44-991f-9315468b91b6/image-20191029155418474.png" alt="image-20191029155418474.png"></p>
<h3 id="Calcite的优势"><a href="#Calcite的优势" class="headerlink" title="Calcite的优势"></a>Calcite的优势</h3><ul>
<li>开源友好：Apache旗下</li>
<li>多种数据模型：关系型、半结构化、流式、地理空间</li>
<li>跨系统支持：可以跨不同数据源做查询优化和查询执行</li>
<li>稳定：久经考验</li>
<li>支持SQL：支持标准SQL和多种SQL方言，支持JDBC</li>
</ul>
<h2 id="Related-Work"><a href="#Related-Work" class="headerlink" title="Related Work"></a>Related Work</h2><p><strong>Orca</strong></p>
<p>Orca是一个模块化优化器，用于Greeplum和HAWK中。</p>
<p>将查询优化和查询执行引擎解耦，中间通过Data eXchange Language交互。</p>
<p><strong>SparkSQL</strong></p>
<p>SparkSQL在Spark基础上扩展支持了SQL查询执行，也可以支持多种数据源。跟Calcite相比，优化过程缺少动态规划方法来避免陷入局部最优。</p>
<p><strong>Algebricks</strong></p>
<p>Algebricks是一个查询编译器，但不需要感知数据模型。高级语言会翻译成Algebricks的逻辑代数，然后生成一个针对Hyracks后端而优化的优化任务。Calcite也支持类似的模块化方法，但Calcite还支持CBO。</p>
<p><strong>Garlic</strong></p>
<p>Garlic支持异构数据源，但不支持跨数据源的优化，只能依赖各个数据源上分别优化。</p>
<p><strong>FORWARD</strong></p>
<p>FORWARD支持SQL++，一种SQL的超集。</p>
<p>SQL++支持半结构化数据模型和关系模型的集成。在这一点上，Calcite是通过在计划生成阶段将半结构化数据表达为关系模型来实现集成的。FORWARD的方法是将多种联合查询拆解成各自的查询计划，然后执行结果在FORWARD引擎中合并。</p>
<h2 id="Architecture"><a href="#Architecture" class="headerlink" title="Architecture"></a>Architecture</h2><p><img src="https://prod-files-secure.s3.us-west-2.amazonaws.com/4c61fdf7-a36e-430e-bcfa-8388fe1d6ec9/a7070d1a-3064-403a-97cb-848517acff59/image-20191029173659790.png" alt="image-20191029173659790.png"></p>
<p><a target="_blank" rel="noopener" href="http://loopjump.com/wp-content/uploads/2019/11/image-20191029173659790-1024x871.png">http://loopjump.com/wp-content/uploads/2019/11/image-20191029173659790-1024x871.png</a></p>
<p>!<a target="_blank" rel="noopener" href="http://loopjump.com/wp-content/uploads/2019/11/image-20191029173659790-1024x871.png">http://loopjump.com/wp-content/uploads/2019/11/image-20191029173659790-1024x871.png</a></p>
<h3 id="Parser-Validator"><a href="#Parser-Validator" class="headerlink" title="Parser &amp; Validator"></a>Parser &amp; Validator</h3><p>Calcite包含一个SQL Parser和Validator，这个模块将SQL解析为a tree of relational operators。因为Calcite不包含存储层，所以解析过程中依赖的schema信息是通过一个adapter层来封装的。</p>
<h3 id="Optimizer"><a href="#Optimizer" class="headerlink" title="Optimizer"></a>Optimizer</h3><p>Calcite包含的优化器部分，可以支持本就支持SQL的系统，如果系统SQL比较弱，比如Hive，虽然支持SQL，但是Hive的优化器很弱。Hive把SQL解析成语法树之后，Calcite可以反过来再恢复成SQL语句，然后再优化。也就是说，Calcite可以直接嵌在不含优化器的SQL系统里面。</p>
<p><a target="_blank" rel="noopener" href="http://loopjump.com/wp-content/uploads/2019/11/image-20191029193634796-1024x650.png">http://loopjump.com/wp-content/uploads/2019/11/image-20191029193634796-1024x650.png</a></p>
<p><img src="https://prod-files-secure.s3.us-west-2.amazonaws.com/4c61fdf7-a36e-430e-bcfa-8388fe1d6ec9/6f9386c4-bb72-4c00-a29b-f7a30f9ec7ec/image-20191029193634796.png" alt="image-20191029193634796.png"></p>
<p>!<a target="_blank" rel="noopener" href="http://loopjump.com/wp-content/uploads/2019/11/image-20191029193634796-1024x650.png">http://loopjump.com/wp-content/uploads/2019/11/image-20191029193634796-1024x650.png</a></p>
<p>Calcite的优化器也可以对接其他系统的parser，Calcite内置了一个relational expressions builder接口。举个例子：</p>
<p>Apache Pig的某个脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">emp = LOAD &#x27;employee_data&#x27; AS (deptno, sal);</span><br><span class="line">emp_by_dept = GROUP emp BY (deptno);</span><br><span class="line">emp_agg = FOREACH emp_by_dept GENERATE GROUP AS deptno COUNT(emp.sal) AS c, SUM(emp.sal) as S;</span><br><span class="line">dump emp_agg;</span><br></pre></td></tr></table></figure>

<p>等价的表达式为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">final RelNode node = builder</span><br><span class="line">  .scan(&quot;employee_data&quot;)</span><br><span class="line">  .aggregate(builder.groupKey(&quot;deptno&quot;)),</span><br><span class="line">             builder.count(false, &quot;c&quot;),</span><br><span class="line">             builder.sum(false, &quot;s&quot;, build.field(&quot;sal&quot;)))</span><br><span class="line">  .build();</span><br></pre></td></tr></table></figure>

<h2 id="Query-Algebra"><a href="#Query-Algebra" class="headerlink" title="Query Algebra"></a>Query Algebra</h2><p>关系代数处于Calcite的核心地位。</p>
<h3 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h3><p>除了常见的filter, project, join等operator，Calcite还引入了能表达更复杂操作的operator，例如window。</p>
<h3 id="Traits"><a href="#Traits" class="headerlink" title="Traits"></a>Traits</h3><p>有些设计里，逻辑执行计划和物理执行计划是不同的实体。在Calcite中，二者是统一的实体，只是会在这个实体上增加一个traits来描述物理属性。</p>
<p>traits能够让优化器评估多个候选的计划。优化过程中，会先给关系表达式指定一些traits，如果需要换另外一种物理实现，可以实现关系表达式的converter接口来指示如何把traits从一个物理实现的值转化为另外一种物理实现的值。</p>
<p>除了ordering, grouping, partitioning这类的traits之外，Calcite中还有一个特殊的traits叫calling convention，它代表了数据源的操作接口，通过这层抽象来实现跨数据源的优化。如下例中，splunk上的scan是按splunk convention，products的scan是按jdbc-mysql convention。如果用Spark来存放splunk表，那么join就会转化成使用spark convention。</p>
<p><img src="https://prod-files-secure.s3.us-west-2.amazonaws.com/4c61fdf7-a36e-430e-bcfa-8388fe1d6ec9/7f0044d3-2b98-4051-b9bb-8b132cd3cd9a/image-20191030112430474.png" alt="image-20191030112430474.png"></p>
<p><a target="_blank" rel="noopener" href="http://loopjump.com/wp-content/uploads/2019/11/image-20191030112430474-1024x462.png">http://loopjump.com/wp-content/uploads/2019/11/image-20191030112430474-1024x462.png</a></p>
<p>!<a target="_blank" rel="noopener" href="http://loopjump.com/wp-content/uploads/2019/11/image-20191030112430474-1024x462.png">http://loopjump.com/wp-content/uploads/2019/11/image-20191030112430474-1024x462.png</a></p>
<h2 id="Query-Processing-And-Optimization"><a href="#Query-Processing-And-Optimization" class="headerlink" title="Query Processing And Optimization"></a>Query Processing And Optimization</h2><p>优化器是Calcite的核心部分，优化器在代价模型指导下，不断地应用优化规则，生成更好的执行计划。优化器的各个组件都是可以扩展的，用户可以添加自己的relational operator, rule, cost model, statistic。</p>
<h3 id="Planner-rules"><a href="#Planner-rules" class="headerlink" title="Planner rules"></a>Planner rules</h3><p>Calcite有几百条优化规则，用户可以在这个基础上添加适用于自己系统的新规则。</p>
<p>例如如下的查询会使用FilterIntoJoinRule规则优化。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT products.name , COUNT (*)</span><br><span class="line">FROM sales JOIN products USING (productId)</span><br><span class="line">WHERE sales.discount IS NOT NULL</span><br><span class="line">GROUP BY products.name</span><br><span class="line">ORDER BY COUNT (*) DESC;</span><br></pre></td></tr></table></figure>

<p>!<a target="_blank" rel="noopener" href="http://loopjump.com/wp-content/uploads/2019/11/image-20191031115353130-300x227.png">http://loopjump.com/wp-content/uploads/2019/11/image-20191031115353130-300x227.png</a></p>
<p><a target="_blank" rel="noopener" href="http://loopjump.com/wp-content/uploads/2019/11/image-20191031115353130-300x227.png">http://loopjump.com/wp-content/uploads/2019/11/image-20191031115353130-300x227.png</a></p>
<p><img src="https://prod-files-secure.s3.us-west-2.amazonaws.com/4c61fdf7-a36e-430e-bcfa-8388fe1d6ec9/4e25092a-d7d6-4337-af60-b3d8de2ed701/image-20191031115353130.png" alt="image-20191031115353130.png"></p>
<h3 id="Metadata-providers"><a href="#Metadata-providers" class="headerlink" title="Metadata providers"></a>Metadata providers</h3><p>Metatadata给优化器提供信息，例如，Calcite里面默认的metadata provider可以提供诸如子表达式的整体代价、返回的行数和数据量、执行表达式时可能的最大并行度等信息。</p>
<p>用户可以使用Calcite的相关接口来实现自己的metadata provider，提供更多的元数据信息。用户的metadata provider作为java源代码提供出来，Calcite使用一个轻量级的Java编译器Janino编译并实例化新的metadata provider。实现上，Calcite还会缓存Metadata的查询结果。</p>
<h3 id="Planner-engine"><a href="#Planner-engine" class="headerlink" title="Planner engine"></a>Planner engine</h3><p>Calcite有两个planner引擎：cost-based planner engine, exhaustive planner。</p>
<p><strong>cost-based planner engine</strong></p>
<p>跟Volcano算法类似，使用动态规划算法。一开始每个子表达式都对应自己的一个等价集合，子表达式不断应用规则，扩大或者合并等价集合。若要获得全局代价最优的计划，则每个子表达式需要从等价集合中采用各自局部最优的那个计划。</p>
<p><strong>exhaustive planner</strong></p>
<p>不断尝试将所有规则应用到最初的计划上，直到不能再应用任何规则。这个方法不需要代价作为指导。</p>
<h3 id="Materialized-views"><a href="#Materialized-views" class="headerlink" title="Materialized views"></a>Materialized views</h3><p>物化视图是通过预计算来降低整体开销的一种思路。</p>
<p>在Calcite中，后端的数据引擎提供物化视图的能力，优化器可以使用这些物化视图来做rewriting。</p>
<p>具体有两种rewriting算法：view substitution, lattices。</p>
<p><strong>view substitution</strong></p>
<p>将原来操作原始表的关系代数子树替换为使用物化视图的等价子树（scan operator和物化视图定义都注册到planner里面）。</p>
<p><strong>lattices</strong></p>
<p>前提是数据源已经被组织成Cube。Cube是数据分析（比如BI）里面比较常见的概念，它是数据的一种组织方式，本质上类似于关系代数里面讲的范式。</p>
<p>在这种前提下，物化视图可以更好地被利用，比如原始表是每日营业额，有个物化视图是月度营业额，那么查询年度营业额就可以用这个物化视图。这里lattice也还是代数系统里面讲的那个偏序关系，比如已经有了一张表&#x2F;视图来表示GroupBy &lt;part, customer&gt;，那么GroupBy part和GroupBy customer都可以使用它。如图（我们只关注图的形状，箭头方向的含义是可以取反定义的）。</p>
<p><img src="https://prod-files-secure.s3.us-west-2.amazonaws.com/4c61fdf7-a36e-430e-bcfa-8388fe1d6ec9/2900ad86-9571-41f3-a6cd-a8c59a4af441/image-20191101215202096.png" alt="image-20191101215202096.png"></p>
<p><a target="_blank" rel="noopener" href="http://loopjump.com/wp-content/uploads/2019/11/image-20191101215202096-300x186.png">http://loopjump.com/wp-content/uploads/2019/11/image-20191101215202096-300x186.png</a></p>
<p>!<a target="_blank" rel="noopener" href="http://loopjump.com/wp-content/uploads/2019/11/image-20191101215202096-300x186.png">http://loopjump.com/wp-content/uploads/2019/11/image-20191101215202096-300x186.png</a></p>
<h2 id="Extending-Calcite"><a href="#Extending-Calcite" class="headerlink" title="Extending Calcite"></a>Extending Calcite</h2><h3 id="Semi-structured-Data"><a href="#Semi-structured-Data" class="headerlink" title="Semi-structured Data"></a>Semi-structured Data</h3><p>Calcite支持多种复杂的列类型，比如ARRAY, MAP, MULTISET。</p>
<p>以mongodb为例，一个存放了城市邮编信息的文档，可以通过如下方式创建视图来转化为关系表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT CAST(_MAP[&#x27;city&#x27;] AS varchar(20)) AS city,</span><br><span class="line">       CAST(_MAP[&#x27;loc&#x27;][0] AS float) AS longtitude,</span><br><span class="line">       CAST(_MAP[&#x27;loc&#x27;][1] AS float) AS latitude,</span><br><span class="line">FROM mongo_raw.zips;</span><br></pre></td></tr></table></figure>

<p>其中，**<code>_MAP</code>** 是Mongodb的adapter提供的数据抽象。</p>
<p>有了这种view over semi-structured data，剩下的就完全是关系表的处理方式了。</p>
<h3 id="Streaming"><a href="#Streaming" class="headerlink" title="Streaming"></a>Streaming</h3><p>Calcite扩展了SQL语法来支持流式数据，例如增加了<code>STREAM</code>关键字，思路上主要是要借助窗口这样的概念来完成流式数据向常规表数据的模拟转化。</p>
<p>所谓流，就是源源不断地进来数据。比如<code>Orders</code>是一个流，可以执行如下的查询：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT STREAM rowtime, productId, units</span><br><span class="line">FROM Orders</span><br><span class="line">WHERE units &gt; 25;</span><br></pre></td></tr></table></figure>

<p>因为流是源源不断的，所以查询不会不断地输出新的数据。</p>
<p>基于流的这个性质，查询往往需要借助窗口这样的概念来实现特定的查询目的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT STREAM rowtime, productId, units, SUM(units)</span><br><span class="line">  OVER (ORDER BY rowtine, PARTITION BY productId RANGE INTERVAL &#x27;1&#x27; HOUR PRECEDING) unitsLastHour</span><br><span class="line">FROM Orders;</span><br></pre></td></tr></table></figure>

<p>此外还有其他各种窗口函数，如 Tumbling Window、Hopping Window、Session Window等。</p>
<p>同样，stream-to-stream join也要表达为基于隐式的窗口函数来做join。</p>
<h3 id="Geospatial-Queries"><a href="#Geospatial-Queries" class="headerlink" title="Geospatial Queries"></a>Geospatial Queries</h3><p>Calcite将GIS对象如point, curve, polygon都统一抽象成GEOMETRY类型。Calcite支持Open GIS Simple Feature Access规范。</p>
<p>查询Amsterdam这个城市所在国家的查询大致如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT name FROM (</span><br><span class="line">  SELECT name,</span><br><span class="line">         ST_GeomFromText(&#x27;POLYGON((4.82 52.43, 4.97 52.43, 4.97 52.33, 4.82 52.33 , 4.82 52.43))&#x27;) AS &quot;Amsterdam&quot;,</span><br><span class="line">         ST_GeomFromText(boundary) AS &quot;Country&quot;</span><br><span class="line">  FROM country</span><br><span class="line">) WHERE ST_Cotain(&quot;Country&quot;, &quot;Amsterdam&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="Language-Integrated-Query-for-Java"><a href="#Language-Integrated-Query-for-Java" class="headerlink" title="Language-Integrated Query for Java"></a>Language-Integrated Query for Java</h3><p>LINQ4J</p>
<h2 id="Industry-and-Academia-Adoption"><a href="#Industry-and-Academia-Adoption" class="headerlink" title="Industry and Academia Adoption"></a>Industry and Academia Adoption</h2><h3 id="Embedded-Calcite"><a href="#Embedded-Calcite" class="headerlink" title="Embedded Calcite"></a>Embedded Calcite</h3><p>内嵌了Calcite的系统：</p>
<ul>
<li>Drill: Dremel上的查询引擎，数据模型是JSON文档，语言类SQL++</li>
<li>Hive: MapReduce之上的SQL接口层</li>
<li>Apache Solr: 全文索引分布式查询引擎，架在Lucene之上，JSON API，借助Calcite提供SQL接口</li>
<li>Apache Phoenix和Apache Kylin: HBase之上的一个查询层</li>
<li>其他： Apex, Flink, Samza, Storm</li>
</ul>
<p>地球上的数据系统可真不少……</p>
<h3 id="Calcite-Adapters"><a href="#Calcite-Adapters" class="headerlink" title="Calcite Adapters"></a>Calcite Adapters</h3><p>Cassandra, Pig, Spark, Druid, Elasticsearch, JDBC, Mongodb, Splunk等。</p>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#SQL" >
    <span class="tag-code">SQL</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/bitcask-intro/">
        <span class="nav-arrow">← </span>
        
          bitcask简介
        
      </a>
    
    
      <a class="nav-right" href="/calvin-intro/">
        
          Calvin简介
        
        <span class="nav-arrow"> →</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- 打赏 START -->
    
    <!-- 打赏 END -->
    <!-- 二维码 START -->
    
      <div class="qrcode">
        <canvas id="share-qrcode"></canvas>
        <p class="notice">扫描二维码，分享此文章</p>
      </div>
    
    <!-- 二维码 END -->
    
      <!-- Utterances START -->
      <div id="utterances"></div>
      <script src="https://utteranc.es/client.js"
        repo=""
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async></script>    
      <!-- Utterances END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Introduction"><span class="toc-nav-text">Introduction</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Calcite%E6%A1%86%E6%9E%B6%E7%BB%84%E6%88%90"><span class="toc-nav-text">Calcite框架组成</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Calcite%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BC%95%E6%93%8E%E7%9A%84%E5%8A%9F%E8%83%BD%E8%BE%B9%E7%95%8C%E5%88%92%E5%88%86"><span class="toc-nav-text">Calcite与数据引擎的功能边界划分</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Calcite%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-nav-text">Calcite的优势</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Related-Work"><span class="toc-nav-text">Related Work</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Architecture"><span class="toc-nav-text">Architecture</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Parser-Validator"><span class="toc-nav-text">Parser &amp; Validator</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Optimizer"><span class="toc-nav-text">Optimizer</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Query-Algebra"><span class="toc-nav-text">Query Algebra</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Operator"><span class="toc-nav-text">Operator</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Traits"><span class="toc-nav-text">Traits</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Query-Processing-And-Optimization"><span class="toc-nav-text">Query Processing And Optimization</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Planner-rules"><span class="toc-nav-text">Planner rules</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Metadata-providers"><span class="toc-nav-text">Metadata providers</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Planner-engine"><span class="toc-nav-text">Planner engine</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Materialized-views"><span class="toc-nav-text">Materialized views</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Extending-Calcite"><span class="toc-nav-text">Extending Calcite</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Semi-structured-Data"><span class="toc-nav-text">Semi-structured Data</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Streaming"><span class="toc-nav-text">Streaming</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Geospatial-Queries"><span class="toc-nav-text">Geospatial Queries</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Language-Integrated-Query-for-Java"><span class="toc-nav-text">Language-Integrated Query for Java</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Industry-and-Academia-Adoption"><span class="toc-nav-text">Industry and Academia Adoption</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Embedded-Calcite"><span class="toc-nav-text">Embedded Calcite</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Calcite-Adapters"><span class="toc-nav-text">Calcite Adapters</span></a></li></ol></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'http://example.com/calcite-intro/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', '/css/images/error_icon.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== '/css/images/error_icon.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>


  <script>
    var qr = new QRious({
      element: document.getElementById('share-qrcode'),
      value: document.location.href
    });
  </script>






    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2024 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    <br>
    Theme by <a target="_blank" rel="noopener" href="https://github.com/yanm1ng">yanm1ng</a>
    
        <br>
        
            <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=2023016451" target="_blank" rel="noopener nofollow"><img src="/css/images/ga.png" width="18" height="18"> 京公网安备 2023016451号</a>
        
    
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      hljs.configure({useBR: true});
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->


<script src="/js/script.js"></script>


  </body>
</html>